<Window x:Class="ATMScoreBoard.Display.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:ATMScoreBoard.Display"
        xmlns:views="clr-namespace:ATMScoreBoard.Display.Views"
        xmlns:converters="clr-namespace:ATMScoreBoard.Display.Converters"
        mc:Ignorable="d"
        Title="ATM ScoreBoard" Height="1080" Width="1920"
        Background="#1E1E1E" Foreground="White"
        WindowState="Maximized" WindowStyle="None" FontFamily="./Fonts/#Poppins">

    <Window.Resources>
        <!-- ... convertidores ... -->
        <converters:BooleanToVisibilityConverter x:Key="BoolToVis" />
        <converters:InverseBooleanToVisibilityConverter x:Key="InverseBoolToVis" />
        
        <!-- Estilo para mover Equipo A (Col 0 -> Col 2) -->
        <Style x:Key="TeamPanelAStyle" TargetType="views:TeamPanel">
            <Setter Property="Grid.Column" Value="0"/>
            <Style.Triggers>
                <DataTrigger  Binding="{Binding DataContext.LadosIntercambiados, RelativeSource={RelativeSource AncestorType=Window}}" Value="True">
                    <Setter Property="Grid.Column" Value="2"/>
                </DataTrigger>
            </Style.Triggers>
        </Style>

        <!-- Estilo para mover Equipo B (Col 2 -> Col 0) -->
        <Style x:Key="TeamPanelBStyle" TargetType="views:TeamPanel">
            <Setter Property="Grid.Column" Value="2"/>
            <Style.Triggers>
                <DataTrigger Binding="{Binding DataContext.LadosIntercambiados, RelativeSource={RelativeSource AncestorType=Window}}" Value="True">
                    <Setter Property="Grid.Column" Value="0"/>
                </DataTrigger>
            </Style.Triggers>
        </Style>
    </Window.Resources>

    <Grid>
        <Grid.Background>
            <ImageBrush ImageSource="pack://application:,,,/Images/background.png" 
                        Stretch="Uniform" 
                        TileMode="None"
                        Opacity="0.05"/>
        </Grid.Background>
        
        
        <!-- ============================================= -->
        <!--             VISTA DEL MARCADOR                -->
        <!-- ============================================= -->
        <Border Visibility="{Binding HayPartidaEnCurso, Converter={StaticResource BoolToVis}}">
            <Grid Margin="20">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="4*" />
                    <ColumnDefinition Width="2.5*" />
                    <ColumnDefinition Width="4*" />
                </Grid.ColumnDefinitions>

                <!-- Panel Equipo A -->

                <views:TeamPanel Style="{StaticResource TeamPanelAStyle}" 
                                 DataContext="{Binding EquipoA}"
                                 BorderColor="{Binding DataContext.BordeEquipoA, RelativeSource={RelativeSource AncestorType=Window}}">
                </views:TeamPanel>

                <!-- Panel Central de Estadísticas -->
                <Grid Grid.Column="1" Margin="20,0">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>
                    <views:StatBox Grid.Row="0" 
                                   Margin="0,25,0,15" 
                                   Title="Ranking" 
                                   IsSwapped="{Binding LadosIntercambiados}"
                                   ValueA="{Binding RankPosicionA}" ValueB="{Binding RankPosicionB}"/>
                    <views:StatBox Grid.Row="1" 
                                   Margin="0,25"      
                                   Title="Puntuación"  
                                   IsSwapped="{Binding LadosIntercambiados}"
                                   ValueA="{Binding RankPuntosA}" ValueB="{Binding RankPuntosB}"/>
                    <views:StatBox Grid.Row="2" 
                                   Margin="0,25"      
                                   Title="Partidas Ganadas"  
                                   IsSwapped="{Binding LadosIntercambiados}"
                                   ValueA="{Binding VictoriasGlobalesA}" ValueB="{Binding VictoriasGlobalesB}"/>
                    <views:StatBox Grid.Row="3" 
                                   Margin="0,25,0,25" 
                                   Title="Enfrentamientos"   
                                   IsSwapped="{Binding LadosIntercambiados}"
                                   ValueA="{Binding VictoriasH2HA}" ValueB="{Binding VictoriasH2HB}"/>
                </Grid>

                <!-- Panel Equipo B -->
                <views:TeamPanel Style="{StaticResource TeamPanelBStyle}" 
                                 DataContext="{Binding EquipoB}"
                                 BorderColor="{Binding DataContext.BordeEquipoB, RelativeSource={RelativeSource AncestorType=Window}}">
                </views:TeamPanel>
            </Grid>
        </Border>

        <!-- ============================================= -->
        <!--            VISTA INACTIVA (RANKING)           -->
        <!-- ============================================= -->
        <Border Visibility="{Binding HayPartidaEnCurso, Converter={StaticResource InverseBoolToVis}}" Padding="50">
            <Grid>
                <Grid.Resources>
                    <!-- Plantillas con clave (x:Key) para evitar problemas de resolución de namespace -->
                    <DataTemplate x:Key="RankingEquiposTemplate">
                        <views:RankingEquiposView DataContext="{Binding DataContext.RankingEquipos, RelativeSource={RelativeSource AncestorType=Window}}"/>
                    </DataTemplate>
                    <DataTemplate x:Key="RankingJugadoresTemplate">
                        <views:RankingJugadoresView DataContext="{Binding DataContext.RankingJugadores, RelativeSource={RelativeSource AncestorType=Window}}"/>
                    </DataTemplate>
                </Grid.Resources>

                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="Auto"/>

                </Grid.RowDefinitions>

                <!-- Título dinámico -->
                <TextBlock Grid.Row="0" HorizontalAlignment="Center" FontSize="48" FontWeight="Bold" Margin="0,0,0,30">
                    <TextBlock.Style>
                        <Style TargetType="TextBlock">
                            <Setter Property="Text" Value="RANKING DE EQUIPOS"/>
                            <Style.Triggers>
                                <DataTrigger Binding="{Binding MostrandoRankingEquipos}" Value="False">
                                    <Setter Property="Text" Value="RANKING DE JUGADORES"/>
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </TextBlock.Style>
                </TextBlock>

                <!-- ContentControl que cambia su plantilla con Triggers -->
                <ContentControl Grid.Row="1">
                    <ContentControl.Style>
                        <Style TargetType="ContentControl">
                            <Setter Property="ContentTemplate" Value="{StaticResource RankingEquiposTemplate}"/>
                            <Style.Triggers>
                                <DataTrigger Binding="{Binding MostrandoRankingEquipos}" Value="False">
                                    <Setter Property="ContentTemplate" Value="{StaticResource RankingJugadoresTemplate}"/>
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </ContentControl.Style>
                </ContentControl>

                <Border Grid.Row="2" 
                        Margin="0,0,0,0" 
                        Padding="5" 
                        Background="#2a2e33" 
                        CornerRadius="5"
                        BorderBrush="Gray"
                        BorderThickness="1"
                        >
                    <StackPanel>

                        <!-- Primer TextBlock (primera línea) -->
                        <TextBlock TextWrapping="Wrap" FontSize="16" Foreground="Gray" TextAlignment="Center">            
                            <Run FontWeight="Bold">¿Cómo se calcula el ranking?</Run>
                            La clasificación se determina por los puntos acumulados en el rendimiento reciente. Para el cálculo, se consideran los resultados de las últimas
                            <Run Text="{Binding PartidasParaRanking}" FontWeight="SemiBold" Foreground="White"/>
                            partidas, siempre que se hayan jugado en los últimos 
                            <Run Text="{Binding DiasParaRanking}" FontWeight="SemiBold" Foreground="White"/>
                            días.           
                            <Run FontWeight="Bold"> Puntuación:</Run> 1 punto por victoria normal, 2 puntos por victoria impecable ("zapatero").
                        </TextBlock>

                        <TextBlock TextWrapping="Wrap" FontSize="16" Foreground="Gray" TextAlignment="Center" Margin="0,0,0,0">             
                            <Run FontWeight="Bold">Disclamer:</Run> Este software es susceptible a mejoras. Si desea expresar alguna opinión o sugerencia, sírvase a enviarnos una email a la dirección <Run FontWeight="Bold">mamame@elguevo.com</Run>. Le responderemos cuando me salga de los cojones.
                        </TextBlock>
                    </StackPanel>
                </Border>


            </Grid>
        </Border>
    </Grid>
</Window>